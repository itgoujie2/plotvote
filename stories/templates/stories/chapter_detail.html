{% extends 'base.html' %}

{% block title %}{{ chapter.title }} - {{ story.title }} - PlotVote{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Chapter Header -->
    <div class="mb-8">
        <a href="{% url 'stories:story_detail' story.slug %}" class="text-indigo-600 hover:text-indigo-700 font-medium mb-4 inline-block">
            ← Back to {{ story.title }}
        </a>

        <h1 class="text-4xl font-bold text-gray-900 mb-2">
            Chapter {{ chapter.chapter_number }}: {{ chapter.title }}
        </h1>
        <div class="text-gray-500 text-sm">
            {{ chapter.word_count }} words • {{ chapter.read_time_minutes }} min read • Published {{ chapter.published_at|date:"F d, Y" }}
        </div>
    </div>

    <!-- Chapter Content -->
    <div class="bg-white rounded-lg shadow-sm p-8 md:p-12 prose prose-lg max-w-none mb-8">
        {{ chapter.content|linebreaks }}
    </div>

    <!-- Navigation -->
    <div class="flex justify-between items-center mb-8">
        <div>
            {% if prev_chapter %}
                <a href="{% url 'stories:chapter_detail' story.slug prev_chapter.chapter_number %}" class="inline-flex items-center bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold px-4 py-2 rounded-lg transition">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Previous Chapter
                </a>
            {% endif %}
        </div>
        <div>
            {% if next_chapter %}
                <a href="{% url 'stories:chapter_detail' story.slug next_chapter.chapter_number %}" class="inline-flex items-center bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg transition">
                    Next Chapter
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
            {% else %}
                <a href="{% url 'stories:story_detail' story.slug %}" class="inline-flex items-center bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg transition">
                    Vote for Next Chapter
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
            {% endif %}
        </div>
    </div>

    <!-- Comments Section -->
    <div class="bg-white rounded-lg shadow-sm p-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">Comments</h2>

        <!-- Add Comment Form -->
        {% if user.is_authenticated %}
            <form method="post" action="{% url 'stories:add_comment' story.slug chapter.chapter_number %}" class="mb-8">
                {% csrf_token %}
                <div class="mb-4">
                    <label for="comment_content" class="block text-sm font-medium text-gray-700 mb-2">Add your comment</label>
                    <textarea
                        name="content"
                        id="comment_content"
                        rows="4"
                        maxlength="1000"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                        placeholder="Share your thoughts about this chapter..."
                        required
                    ></textarea>
                    <p class="text-sm text-gray-500 mt-1">Maximum 1000 characters</p>
                </div>
                <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-2 rounded-lg transition">
                    Post Comment
                </button>
            </form>
        {% else %}
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-8 text-center">
                <p class="text-gray-600">
                    <a href="{% url 'login' %}?next={{ request.path }}" class="text-indigo-600 hover:text-indigo-700 font-semibold">Log in</a>
                    or
                    <a href="{% url 'users:register' %}?next={{ request.path }}" class="text-indigo-600 hover:text-indigo-700 font-semibold">register</a>
                    to comment
                </p>
            </div>
        {% endif %}

        <!-- Display Comments -->
        {% if comments %}
            <div class="space-y-4">
                {% for comment in comments %}
                    <div class="border-l-4 border-indigo-500 pl-4 py-2">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="font-semibold text-gray-900">{{ comment.user.username }}</span>
                            <span class="text-gray-500 text-sm">{{ comment.created_at|timesince }} ago</span>
                        </div>
                        <p class="text-gray-700">{{ comment.content }}</p>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-gray-500 text-center py-8">No comments yet. Be the first to comment!</p>
        {% endif %}
    </div>
</div>
{% endblock %}
