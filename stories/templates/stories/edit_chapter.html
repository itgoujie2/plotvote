{% extends 'base.html' %}

{% block title %}Edit Chapter {{ chapter.chapter_number }} - {{ story.title }} - PlotVote{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="mb-8">
        <a href="{% url 'stories:chapter_detail' story.slug chapter.chapter_number %}" class="text-indigo-600 hover:text-indigo-700 font-medium mb-4 inline-block">
            ← Back to Chapter {{ chapter.chapter_number }}
        </a>
        <h1 class="text-4xl font-bold text-gray-900 mb-2">Edit Chapter {{ chapter.chapter_number }}</h1>
        <p class="text-gray-600">{{ story.title }}</p>
    </div>

    <div class="bg-white rounded-lg shadow-sm p-8">
        <form method="post" action="{% url 'stories:edit_chapter' story.slug chapter.chapter_number %}">
            {% csrf_token %}

            <!-- Chapter Title -->
            <div class="mb-6">
                <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                    Chapter Title
                </label>
                <input
                    type="text"
                    id="title"
                    name="title"
                    value="{{ chapter.title }}"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                    required
                >
            </div>

            <!-- Chapter Content -->
            <div class="mb-6">
                <label for="content" class="block text-sm font-medium text-gray-700 mb-2">
                    Chapter Content
                </label>
                <textarea
                    id="content"
                    name="content"
                    rows="20"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 font-mono text-sm"
                    required
                >{{ chapter.content }}</textarea>
                <p class="text-sm text-gray-500 mt-2">
                    Current: {{ chapter.word_count }} words • {{ chapter.read_time_minutes }} min read
                </p>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4">
                <button
                    type="submit"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-3 rounded-lg transition"
                >
                    Save Changes
                </button>
                <a
                    href="{% url 'stories:chapter_detail' story.slug chapter.chapter_number %}"
                    class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold px-6 py-3 rounded-lg transition"
                >
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Preview Section (Optional) -->
    <div class="bg-white rounded-lg shadow-sm p-8 mt-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Preview</h2>
        <div id="preview" class="prose prose-lg max-w-none">
            {{ chapter.content|linebreaks }}
        </div>
    </div>
</div>

<script>
    // Live preview update
    const contentTextarea = document.getElementById('content');
    const previewDiv = document.getElementById('preview');

    contentTextarea.addEventListener('input', function() {
        const content = this.value;
        // Convert newlines to <p> tags for preview
        const htmlContent = content.split('\n\n').map(paragraph => {
            if (paragraph.trim()) {
                return '<p>' + paragraph.replace(/\n/g, '<br>') + '</p>';
            }
            return '';
        }).join('');
        previewDiv.innerHTML = htmlContent || '<p class="text-gray-400">Preview will appear here...</p>';
    });
</script>
{% endblock %}
