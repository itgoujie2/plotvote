{% extends 'base.html' %}

{% block title %}Create Personal Story - PlotVote{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <a href="{% url 'stories:my_stories' %}" class="text-indigo-600 hover:text-indigo-700 font-medium mb-4 inline-block">
        ‚Üê Back to My Stories
    </a>

    <div class="bg-white rounded-lg shadow-sm p-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Create Personal Story</h1>
        <p class="text-gray-600 mb-6">Start a new story that you can write chapter by chapter using AI</p>

        <!-- Quick Start Guide -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
            <h3 class="font-semibold text-blue-900 mb-3 flex items-center gap-2">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
                Quick Start Guide
            </h3>
            <p class="text-sm text-blue-900 mb-4">
                Not sure where to start? Here's a simple example:
            </p>

            <div class="bg-white rounded-lg p-4 space-y-3 text-sm">
                <div>
                    <span class="font-semibold text-gray-900">Title:</span>
                    <span class="text-gray-700"> "The Last Signal from Europa"</span>
                </div>
                <div>
                    <span class="font-semibold text-gray-900">Story Premise:</span>
                    <p class="text-gray-700 mt-1">
                        "Dr. Sarah Chen receives an encrypted distress signal from the Europa Research Station‚Äîa facility she helped design five years ago. The station has been silent for three months, and the signal contains her biometric signature. As she decodes the message, she discovers it's not a cry for help, but a warning: 'Don't send anyone. Don't come looking. I'm already dead.' The problem? The message was sent yesterday, and Sarah has been on Earth the entire time."
                    </p>
                </div>
                <div>
                    <span class="font-semibold text-gray-900">Genre:</span>
                    <span class="text-gray-700"> Science Fiction</span>
                    <span class="mx-2">‚Ä¢</span>
                    <span class="font-semibold text-gray-900">Language:</span>
                    <span class="text-gray-700"> English</span>
                    <span class="mx-2">‚Ä¢</span>
                    <span class="font-semibold text-gray-900">Chapters:</span>
                    <span class="text-gray-700"> 10</span>
                </div>
            </div>

            <div class="mt-4 pt-4 border-t border-blue-200">
                <div class="flex items-start justify-between gap-4">
                    <p class="text-sm text-blue-900 flex-1">
                        <strong>üí° Tip:</strong> The Story Framework section (below) is optional, but filling it out helps AI maintain consistency across chapters. Think of it as your story bible!
                    </p>
                    <a href="/story/the-last-signal-from-europa/" target="_blank" class="text-sm bg-blue-100 hover:bg-blue-200 text-blue-800 font-medium px-4 py-2 rounded-lg transition whitespace-nowrap">
                        View Example Story ‚Üí
                    </a>
                </div>
            </div>
        </div>

        <form method="post" class="space-y-6">
            {% csrf_token %}

            <div>
                <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                    Story Title *
                </label>
                <input
                    type="text"
                    id="title"
                    name="title"
                    required
                    maxlength="200"
                    placeholder="The Quest for the Lost Kingdom"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                />
            </div>

            <div>
                <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                    Story Premise * (min 50 characters)
                </label>
                <textarea
                    id="description"
                    name="description"
                    rows="5"
                    required
                    minlength="50"
                    placeholder="Describe the world, main characters, and initial setup for your story..."
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                ></textarea>
                <p class="text-sm text-gray-500 mt-1">
                    This will guide the AI in generating your story chapters
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="genre" class="block text-sm font-medium text-gray-700 mb-2">
                        Genre
                    </label>
                    <select
                        id="genre"
                        name="genre"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    >
                        {% for value, label in genre_choices %}
                            <option value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label for="language" class="block text-sm font-medium text-gray-700 mb-2">
                        Language
                    </label>
                    <select
                        id="language"
                        name="language"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    >
                        {% for value, label in language_choices %}
                            <option value="{{ value }}" {% if value == 'en' %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Story Framework Section (Optional but Recommended) -->
            <div class="border border-gray-300 rounded-lg">
                <button
                    type="button"
                    onclick="toggleFramework()"
                    class="w-full flex items-center justify-between px-6 py-4 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-t-lg hover:from-purple-100 hover:to-indigo-100 transition"
                >
                    <div class="flex items-center gap-3">
                        <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <div class="text-left">
                            <h3 class="font-bold text-gray-900">Story Framework (Optional but Recommended)</h3>
                            <p class="text-sm text-gray-600">Help AI maintain consistency across chapters</p>
                        </div>
                    </div>
                    <svg id="framework-chevron" class="w-5 h-5 text-gray-500 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>

                <div id="framework-section" class="hidden px-6 pb-6 pt-4 space-y-6 bg-gray-50 rounded-b-lg">
                    <div class="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4">
                        <p class="text-sm text-amber-900">
                            <strong>Why use a Story Framework?</strong> The AI will use these details as context when generating each chapter, ensuring character names, traits, world rules, and plot remain consistent throughout your story.
                        </p>
                    </div>

                    <div>
                        <label for="characters" class="block text-sm font-medium text-gray-700 mb-2">
                            Main Characters
                        </label>
                        <textarea
                            id="characters"
                            name="characters"
                            rows="6"
                            placeholder="Aria Ironforge (protagonist): 19-year-old blacksmith, brave but inexperienced, orphaned at age 5, skilled craftsman, stubborn. Dreams of adventure beyond her village.

Master Torin: Elderly blacksmith mentor, 68 years old, knows Aria's secret heritage, protective father figure.

Prince Kael: Reluctant ally, 24, heir to the Northern Kingdom, duty-bound but compassionate, skilled swordsman."
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-mono text-sm"
                        ></textarea>
                        <p class="text-sm text-gray-500 mt-1">
                            List main characters with names, ages, personalities, skills, and character arcs
                        </p>
                    </div>

                    <div>
                        <label for="story_outline" class="block text-sm font-medium text-gray-700 mb-2">
                            Story Outline / Plot Structure
                        </label>
                        <textarea
                            id="story_outline"
                            name="story_outline"
                            rows="8"
                            placeholder="Act 1: Discovery (Chapters 1-5)
- Aria finds dragon egg in her forge
- Learns about her true heritage from Master Torin
- Village attacked by Shadow Council, forced to flee

Act 2: Journey (Chapters 6-15)
- Travel through the five kingdoms seeking allies
- Meet Prince Kael, reluctant partnership forms
- Learn dragon magic, egg begins to hatch
- Discover Shadow Council's true motives

Act 3: Confrontation (Chapters 16-20)
- Final battle with Shadow Council
- Aria's dragon hatches, first flight
- Restore balance to the realm
- Aria accepts her role as Dragon Heir"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-mono text-sm"
                        ></textarea>
                        <p class="text-sm text-gray-500 mt-1">
                            Outline your story's major plot points, acts, and planned story arc
                        </p>
                    </div>

                    <div>
                        <label for="world_building" class="block text-sm font-medium text-gray-700 mb-2">
                            World Building & Setting
                        </label>
                        <textarea
                            id="world_building"
                            name="world_building"
                            rows="6"
                            placeholder="Setting: Medieval fantasy world, five kingdoms (North: icy mountains, South: desert plains, East: ancient forests, West: coastal cities, Central: volcanic highlands)

Magic System: Dragon-bonded magic - only those with dragon blood can wield elemental powers. Magic is rare, feared by common folk.

Technology: Medieval level with minor magic enhancements. No gunpowder. Blacksmiths are highly respected.

History: Dragons vanished 100 years ago during The Great Silence. Reason unknown. Most believe dragons are extinct.

Society: Monarchies rule each kingdom. Blacksmiths' Guild holds political power."
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-mono text-sm"
                        ></textarea>
                        <p class="text-sm text-gray-500 mt-1">
                            Describe your world's setting, magic system, technology level, and important rules
                        </p>
                    </div>

                    <div>
                        <label for="themes" class="block text-sm font-medium text-gray-700 mb-2">
                            Themes & Tone
                        </label>
                        <textarea
                            id="themes"
                            name="themes"
                            rows="4"
                            placeholder="Themes: Coming of age, finding your true identity, responsibility vs. freedom, balance between power and wisdom

Tone: Epic fantasy with personal stakes, moments of humor to balance intensity, focus on character growth over action, hopeful despite challenges"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-mono text-sm"
                        ></textarea>
                        <p class="text-sm text-gray-500 mt-1">
                            What themes does your story explore? What's the overall tone and mood?
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="planned_chapters" class="block text-sm font-medium text-gray-700 mb-2">
                                Planned Total Chapters
                            </label>
                            <input
                                type="number"
                                id="planned_chapters"
                                name="planned_chapters"
                                min="1"
                                max="200"
                                placeholder="20"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            >
                            <p class="text-sm text-gray-500 mt-1">
                                Estimated total chapters (can be adjusted later)
                            </p>
                        </div>

                        <div>
                            <label for="writing_style_notes" class="block text-sm font-medium text-gray-700 mb-2">
                                Writing Style Preferences
                            </label>
                            <textarea
                                id="writing_style_notes"
                                name="writing_style_notes"
                                rows="3"
                                placeholder="Third-person limited (Aria's POV), descriptive but accessible prose, balance action with introspection, end chapters with hooks"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-mono text-sm"
                            ></textarea>
                            <p class="text-sm text-gray-500 mt-1">
                                POV, narrative style, pacing preferences
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                function toggleFramework() {
                    const section = document.getElementById('framework-section');
                    const chevron = document.getElementById('framework-chevron');

                    if (section.classList.contains('hidden')) {
                        section.classList.remove('hidden');
                        chevron.classList.add('rotate-180');
                    } else {
                        section.classList.add('hidden');
                        chevron.classList.remove('rotate-180');
                    }
                }
            </script>

            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                <h3 class="font-semibold text-indigo-900 mb-2">About Personal Stories</h3>
                <ul class="text-sm text-indigo-800 space-y-1">
                    <li>‚Ä¢ Your stories are private - only you can see and edit them</li>
                    <li>‚Ä¢ Write prompts for each chapter and let AI generate the content</li>
                    <li>‚Ä¢ AI considers your story premise and previous chapters for consistency</li>
                    <li>‚Ä¢ Edit and refine as you go to create your perfect story</li>
                </ul>
            </div>

            <div class="flex gap-4">
                <button type="submit" class="flex-1 bg-indigo-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-indigo-700 transition">
                    Create Story
                </button>
                <a href="{% url 'stories:my_stories' %}" class="px-6 py-3 text-gray-700 font-semibold hover:text-gray-900 transition">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
